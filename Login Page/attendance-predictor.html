<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Attendance Predictor</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome for icons -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />

  <!-- React & ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Shared data for subjects -->
  <script src="wizup-data.js"></script>

  <style>
    body {
      background-image: url("../bg1.jpg");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    
    /* Enhanced animations */
    @keyframes slideInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    
    .animate-in {
      animation: slideInUp 0.6s ease-out;
    }
    
    .pulse-on-hover:hover {
      animation: pulse 0.3s ease-in-out;
    }
    
    /* Enhanced glass effect */
    .glass-enhanced {
      background: rgba(15, 23, 42, 0.75);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
    }
  </style>
</head>
<body class="min-h-screen bg-slate-950/90">
  <div id="root"></div>

  <script>
    // Simple auth guard: require a signed-in student
    (function () {
      try {
        const raw = localStorage.getItem("wizup.currentUser");
        if (!raw) {
          window.location.href = "student-signin.html";
          return;
        }
      } catch (e) {
        window.location.href = "student-signin.html";
      }
    })();
  </script>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;

    // Use shared subject data (fallback to embedded array if missing)
    const SUBJECT_DATA = window.WIZUP_SUBJECTS && Array.isArray(window.WIZUP_SUBJECTS) ? window.WIZUP_SUBJECTS : [
      { id: "java-programming", name: "Java Programming", total: 60, attended: 54, minRequired: 75 }
    ];

    const RiskBadge = ({ riskLevel }) => {
      let colorClasses = "bg-emerald-500/20 text-emerald-300 border-emerald-500/60";
      let label = "Safe";

      if (riskLevel === "yellow") {
        colorClasses = "bg-amber-500/20 text-amber-300 border-amber-500/60";
        label = "Warning";
      } else if (riskLevel === "red") {
        colorClasses = "bg-rose-500/20 text-rose-300 border-rose-500/60";
        label = "At Risk";
      }

      return (
        <span
          className={
            "inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-semibold uppercase tracking-wide " +
            colorClasses
          }
        >
          <span className="h-2 w-2 rounded-full bg-current" />
          {label}
        </span>
      );
    };

    const ResultCard = ({ title, value, highlightColor, children }) => {
      const borderColor =
        highlightColor === "green"
          ? "border-emerald-400/60"
          : highlightColor === "yellow"
          ? "border-amber-400/60"
          : highlightColor === "red"
          ? "border-rose-400/60"
          : "border-slate-500/60";

      const glowColor =
        highlightColor === "green"
          ? "shadow-emerald-500/40"
          : highlightColor === "yellow"
          ? "shadow-amber-500/40"
          : highlightColor === "red"
          ? "shadow-rose-500/40"
          : "shadow-slate-500/40";

      return (
        <div
          className={
            "group rounded-2xl border " +
            borderColor +
            " bg-slate-900/60 p-4 shadow-lg " +
            glowColor +
            " backdrop-blur-md transition-transform duration-300 hover:-translate-y-1 hover:shadow-xl"
          }
        >
          <div className="mb-2 flex items-center justify-between">
            <h3 className="text-xs font-semibold uppercase tracking-wide text-slate-300">
              {title}
            </h3>
          </div>
          <div className="text-2xl font-bold tracking-tight text-slate-50">
            {value}
          </div>
          {children && (
            <div className="mt-2 text-xs text-slate-300">{children}</div>
          )}
        </div>
      );
    };

    const AttendanceChart = ({ data }) => {
      const canvasRef = useRef(null);
      const chartRef = useRef(null);

      useEffect(() => {
        const ctx = canvasRef.current?.getContext("2d");
        if (!ctx || !data) return;

        if (chartRef.current) {
          chartRef.current.destroy();
        }

        chartRef.current = new Chart(ctx, {
          type: "line",
          data,
          options: {
            responsive: true,
            plugins: {
              legend: {
                labels: {
                  color: "#e5e7eb",
                  font: { size: 11 },
                },
              },
              tooltip: {
                mode: "index",
                intersect: false,
              },
            },
            scales: {
              x: {
                ticks: { color: "#9ca3af", font: { size: 10 } },
                grid: { color: "rgba(55,65,81,0.4)" },
              },
              y: {
                ticks: {
                  color: "#9ca3af",
                  font: { size: 10 },
                  callback: (v) => v + "%",
                },
                grid: { color: "rgba(55,65,81,0.4)" },
                suggestedMin: 50,
                suggestedMax: 100,
              },
            },
          },
        });

        return () => {
          if (chartRef.current) {
            chartRef.current.destroy();
          }
        };
      }, [data]);

      return (
        <div className="rounded-2xl border border-slate-600/60 bg-slate-900/70 p-4 shadow-lg shadow-sky-500/30 backdrop-blur-xl">
          <div className="mb-3 flex items-center justify-between">
            <h3 className="text-sm font-semibold text-slate-100">
              Attendance Trend (Next 10 Classes)
            </h3>
          </div>
          <canvas ref={canvasRef} className="w-full" height={160} />
        </div>
      );
    };

    const AttendancePredictor = () => {
      const [totalLectures, setTotalLectures] = useState("");
      const [lecturesAttended, setLecturesAttended] = useState("");
      const [minRequired, setMinRequired] = useState(75);
      const [medicalLeave, setMedicalLeave] = useState("");
      const [dutyLeave, setDutyLeave] = useState("");
      const [planSkips, setPlanSkips] = useState("");

      const [errors, setErrors] = useState({});
      const [isLoading, setIsLoading] = useState(false);

      const [currentAttendance, setCurrentAttendance] = useState(null);
      const [status, setStatus] = useState(null);
      const [canSkip, setCanSkip] = useState(null);
      const [mustAttend, setMustAttend] = useState(null);
      const [riskLevel, setRiskLevel] = useState(null);

      const [apiResponse, setApiResponse] = useState(null);
      const [chartData, setChartData] = useState(null);
      const [plannedAttendance, setPlannedAttendance] = useState(null);
      const [selectedSubjectId, setSelectedSubjectId] = useState(null);

      const selectedSubject = useMemo(
        () => SUBJECT_DATA.find((s) => s.id === selectedSubjectId) || null,
        [selectedSubjectId]
      );

      const applySubject = (subject) => {
        setSelectedSubjectId(subject.id);
        setTotalLectures(String(subject.total));
        setLecturesAttended(String(subject.attended));
        setMinRequired(subject.minRequired);
        setMedicalLeave("");
        setDutyLeave("");
        setPlanSkips("");
      };

      useEffect(() => {
        const params = new URLSearchParams(window.location.search);
        const subjParam = params.get("subject");
        if (subjParam) {
          const decoded = decodeURIComponent(subjParam).toLowerCase();
          const found = SUBJECT_DATA.find(
            (s) =>
              s.id.toLowerCase() === decoded ||
              s.name.toLowerCase() === decoded
          );
          if (found) {
            applySubject(found);
          }
        }
      }, []);

      const validate = () => {
        const errs = {};
        const total = Number(totalLectures);
        const attended = Number(lecturesAttended);
        const minReq = Number(minRequired);
        const med = medicalLeave === "" ? 0 : Number(medicalLeave);
        const dl = dutyLeave === "" ? 0 : Number(dutyLeave);
        const skips = planSkips === "" ? 0 : Number(planSkips);

        if (!Number.isFinite(total) || total <= 0) {
          errs.totalLectures = "Total lectures must be a positive number.";
        }
        if (!Number.isFinite(attended) || attended < 0) {
          errs.lecturesAttended = "Lectures attended cannot be negative.";
        }
        if (Number.isFinite(total) && Number.isFinite(attended) && attended > total) {
          errs.lecturesAttended = "Lectures attended cannot be greater than total lectures.";
        }
        if (!Number.isFinite(minReq) || minReq <= 0 || minReq > 100) {
          errs.minRequired = "Minimum required must be between 1 and 100.";
        }
        if (!Number.isFinite(med) || med < 0) {
          errs.medicalLeave = "Medical leave cannot be negative.";
        }
        if (Number.isFinite(med) && Number.isFinite(total) && med > total) {
          errs.medicalLeave = "Medical leave cannot exceed total lectures.";
        }
        if (!Number.isFinite(dl) || dl < 0) {
          errs.dutyLeave = "Duty leave cannot be negative.";
        }
        if (Number.isFinite(dl) && Number.isFinite(total) && dl > total) {
          errs.dutyLeave = "Duty leave cannot exceed total lectures.";
        }
        if (
          Number.isFinite(med) &&
          Number.isFinite(dl) &&
          Number.isFinite(total) &&
          med + dl > total
        ) {
          errs.dutyLeave = "Medical + duty leave cannot exceed total lectures.";
        }
        if (!Number.isFinite(skips) || skips < 0) {
          errs.planSkips = "Planned skips cannot be negative.";
        }

        setErrors(errs);
        return Object.keys(errs).length === 0;
      };

      const getRiskLevel = (pct) => {
        if (pct >= 75) return "green";
        if (pct >= 70) return "yellow";
        return "red";
      };

      const handlePredict = async (e) => {
        e.preventDefault();
        if (!validate()) return;

        const total = Number(totalLectures);
        const attended = Number(lecturesAttended);
        const minReq = Number(minRequired);
        const med = medicalLeave === "" ? 0 : Number(medicalLeave);
        const dl = dutyLeave === "" ? 0 : Number(dutyLeave);
        const skips = planSkips === "" ? 0 : Number(planSkips);

        const adjustedTotal = Math.max(total - med - dl, 1);
        const attendancePct = (attended / adjustedTotal) * 100;

        const risk = getRiskLevel(attendancePct);
        setCurrentAttendance(attendancePct.toFixed(2));
        setRiskLevel(risk);

        const p = minReq / 100;

        let eligible = attendancePct >= minReq;
        let canSkipClasses = 0;
        let mustAttendClasses = 0;

        if (eligible) {
          const maxAdditionalAbsences = attended * (100 / minReq) - adjustedTotal;
          canSkipClasses = Math.max(0, Math.floor(maxAdditionalAbsences));
          setCanSkip(canSkipClasses);
          setMustAttend(null);
          setStatus("Eligible");
        } else {
          if (p < 1) {
            const needed = (p * adjustedTotal - attended) / (1 - p);
            mustAttendClasses = Math.max(0, Math.ceil(needed));
          } else {
            mustAttendClasses = Infinity;
          }
          setMustAttend(mustAttendClasses === Infinity ? "∞" : mustAttendClasses);
          setCanSkip(null);
          setStatus("Not Eligible");
        }

        if (skips > 0) {
          const futureTotal = adjustedTotal + skips;
          const futureAttended = attended;
          const plannedPct = (futureAttended / futureTotal) * 100;
          setPlannedAttendance(plannedPct.toFixed(2));
        } else {
          setPlannedAttendance(null);
        }

        const labels = Array.from({ length: 10 }, (_, i) => `+${i + 1}`);
        const baselineData = labels.map((_, idx) => {
          const i = idx + 1;
          const pct = ((attended + i) / (adjustedTotal + i)) * 100;
          return Number(pct.toFixed(2));
        });

        let plannedData = null;
        if (skips > 0) {
          plannedData = labels.map((_, idx) => {
            const i = idx + 1;
            const skippedSoFar = Math.min(skips, i);
            const attendedFuture = i - skippedSoFar;
            const pct = ((attended + attendedFuture) / (adjustedTotal + i)) * 100;
            return Number(pct.toFixed(2));
          });
        }

        const datasets = [
          {
            label: "Attend All",
            data: baselineData,
            borderColor: "#22c55e",
            backgroundColor: "rgba(34,197,94,0.2)",
            tension: 0.3,
            pointRadius: 3,
          },
        ];

        if (plannedData) {
          datasets.push({
            label: "With Planned Skips",
            data: plannedData,
            borderColor: "#f97316",
            backgroundColor: "rgba(249,115,22,0.2)",
            tension: 0.3,
            pointRadius: 3,
          });
        }

        setChartData({
          labels,
          datasets,
        });

        setIsLoading(true);
        try {
          const res = await fetch("http://127.0.0.1:8000/predict-attendance", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              attended,
              total,
              min_required: minReq,
            }),
          });

          if (!res.ok) throw new Error("API error");
          const data = await res.json().catch(() => ({}));
          setApiResponse(data);
        } catch (err) {
          setApiResponse({ error: "Unable to reach prediction API." });
        } finally {
          setIsLoading(false);
        }
      };

      const statusColor = useMemo(() => {
        if (!status) return null;
        if (status === "Eligible") return "green";
        return "red";
      }, [status]);

      const currentColor = useMemo(() => {
        if (!currentAttendance) return null;
        if (riskLevel === "green") return "green";
        if (riskLevel === "yellow") return "yellow";
        return "red";
      }, [currentAttendance, riskLevel]);

      return (
        <div className="min-h-screen bg-slate-950/90 px-4 py-6 md:px-10 md:py-8">
          <div className="mx-auto max-w-6xl rounded-3xl glass-enhanced p-6 shadow-2xl shadow-emerald-500/30 backdrop-blur-2xl animate-in">
            <header className="mb-6 flex flex-col gap-4 md:mb-8 md:flex-row md:items-center md:justify-between">
              <div>
                <h1 className="bg-gradient-to-r from-emerald-400 via-sky-400 to-cyan-400 bg-clip-text text-3xl font-extrabold tracking-tight text-transparent md:text-4xl animate-in">
                  Smart Attendance Predictor
                </h1>
                <p className="mt-2 text-sm text-slate-300 md:text-base animate-in" style="animation-delay: 0.1s;">
                  Plan your lectures, stay above required attendance, and manage your risk in real time.
                </p>
                {selectedSubject && (
                  <p className="mt-2 text-sm font-semibold text-emerald-300 md:text-base animate-in" style="animation-delay: 0.2s;">
                    Currently analyzing: {selectedSubject.name}
                  </p>
                )}
              </div>
              <RiskBadge riskLevel={riskLevel || "green"} className="animate-in" style="animation-delay: 0.3s;" />
            </header>

            <section className="mb-6 rounded-3xl glass-enhanced p-5 shadow-lg shadow-sky-500/30 animate-in" style="animation-delay: 0.4s;">
              <div className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                <div>
                  <h2 className="text-lg font-bold uppercase tracking-wide text-slate-100">
                    Subject-wise Attendance Overview
                  </h2>
                  <p className="text-sm text-slate-300">
                    Delivered vs attended lectures for each subject. Click "Open" to load a subject into the predictor.
                  </p>
                </div>
                <div className="flex gap-2">
                  <button 
                    onClick={() => {
                      const totalLectures = SUBJECT_DATA.reduce((sum, s) => sum + s.total, 0);
                      const totalAttended = SUBJECT_DATA.reduce((sum, s) => sum + s.attended, 0);
                      setTotalLectures(String(totalLectures));
                      setLecturesAttended(String(totalAttended));
                      setSelectedSubjectId(null);
                    }}
                    className="px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg transition-colors text-sm font-semibold"
                  >
                    Load All Subjects
                  </button>
                </div>
              </div>
              <div className="mt-4 overflow-x-auto text-sm">
                <table className="min-w-full border-separate border-spacing-y-2">
                  <thead>
                    <tr className="text-xs uppercase tracking-wide text-slate-400">
                      <th className="py-3 pr-4 text-left font-semibold">Subject</th>
                      <th className="py-3 px-2 text-left font-semibold">Attended / Delivered</th>
                      <th className="py-3 px-2 text-left font-semibold">% Attendance</th>
                      <th className="py-3 px-2 text-left font-semibold">Status</th>
                      <th className="py-3 pl-2 text-right font-semibold">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    {SUBJECT_DATA.map((subj, index) => {
                      const pct = ((subj.attended / subj.total) * 100).toFixed(2);
                      const isActive = selectedSubject && selectedSubject.id === subj.id;
                      const status = pct >= 85 ? 'Excellent' : pct >= 75 ? 'Good' : pct >= 70 ? 'Average' : 'At Risk';
                      const statusColor = pct >= 85 ? 'text-green-300' : pct >= 75 ? 'text-blue-300' : pct >= 70 ? 'text-yellow-300' : 'text-red-300';
                      
                      return (
                        <tr
                          key={subj.id}
                          className={
                            "rounded-xl border border-transparent bg-slate-900/60 text-slate-100 transition-all duration-300 hover:scale-[1.02] " +
                            (isActive ? "border-emerald-500/60 bg-emerald-500/10 shadow-lg shadow-emerald-500/30" : "hover:bg-slate-800/80 hover:border-slate-600/50")
                          }
                          style={{animationDelay: `${0.5 + index * 0.1}s`}}
                        >
                          <td className="py-3 pr-4 text-left text-sm font-medium">
                            {subj.name}
                          </td>
                          <td className="py-3 px-2 text-left text-sm">
                            <span className="font-semibold">{subj.attended}</span> / {subj.total}
                          </td>
                          <td className="py-3 px-2 text-left text-sm">
                            <span className={`font-bold ${statusColor}`}>{pct}%</span>
                          </td>
                          <td className="py-3 px-2 text-left text-sm">
                            <span className={`px-2 py-1 rounded-full text-xs font-semibold ${statusColor} bg-current/10`}>
                              {status}
                            </span>
                          </td>
                          <td className="py-3 pl-2 text-right">
                            <button
                              type="button"
                              onClick={() => applySubject(subj)}
                              className="inline-flex items-center rounded-full bg-sky-500/90 hover:bg-sky-400 px-3 py-1.5 text-xs font-semibold text-slate-950 shadow-sm shadow-sky-500/40 transition-all duration-200 hover:shadow-lg hover:scale-105"
                            >
                              Open
                            </button>
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
            </section>

            <div className="grid gap-6 lg:grid-cols-3">
              {/* Left: Input form */}
              <section className="lg:col-span-1">
                <div className="rounded-3xl border border-slate-700/70 bg-slate-900/70 p-5 shadow-xl shadow-emerald-500/20 backdrop-blur-2xl">
                  <h2 className="mb-4 text-sm font-semibold uppercase tracking-wide text-slate-200">
                    Input Details
                  </h2>
                  <form onSubmit={handlePredict} className="space-y-4">
                    <div>
                      <label className="mb-1 block text-xs font-semibold uppercase tracking-wide text-slate-300">
                        Total Lectures Conducted
                      </label>
                      <input
                        type="number"
                        min="1"
                        className="w-full rounded-xl border border-slate-600/70 bg-slate-900/70 px-3 py-2 text-sm text-slate-100 outline-none ring-emerald-500/40 placeholder:text-slate-500 focus:border-emerald-400 focus:ring-2"
                        value={totalLectures}
                        onChange={(e) => setTotalLectures(e.target.value)}
                        placeholder="e.g. 60"
                      />
                      {errors.totalLectures && (
                        <p className="mt-1 text-xs text-rose-400">
                          {errors.totalLectures}
                        </p>
                      )}
                    </div>

                    <div>
                      <label className="mb-1 block text-xs font-semibold uppercase tracking-wide text-slate-300">
                        Lectures Attended
                      </label>
                      <input
                        type="number"
                        min="0"
                        className="w-full rounded-xl border border-slate-600/70 bg-slate-900/70 px-3 py-2 text-sm text-slate-100 outline-none ring-emerald-500/40 placeholder:text-slate-500 focus:border-emerald-400 focus:ring-2"
                        value={lecturesAttended}
                        onChange={(e) => setLecturesAttended(e.target.value)}
                        placeholder="e.g. 48"
                      />
                      {errors.lecturesAttended && (
                        <p className="mt-1 text-xs text-rose-400">
                          {errors.lecturesAttended}
                        </p>
                      )}
                    </div>

                    <div className="grid grid-cols-1 gap-3 sm:grid-cols-2">
                      <div>
                        <label className="mb-1 block text-xs font-semibold uppercase tracking-wide text-slate-300">
                          Minimum Required Attendance (%)
                        </label>
                        <input
                          type="number"
                          min="1"
                          max="100"
                          className="w-full rounded-xl border border-slate-600/70 bg-slate-900/70 px-3 py-2 text-sm text-slate-100 outline-none ring-emerald-500/40 placeholder:text-slate-500 focus:border-emerald-400 focus:ring-2"
                          value={minRequired}
                          onChange={(e) => setMinRequired(e.target.value)}
                        />
                        {errors.minRequired && (
                          <p className="mt-1 text-xs text-rose-400">
                            {errors.minRequired}
                          </p>
                        )}
                      </div>

                      <div>
                        <label className="mb-1 block text-xs font-semibold uppercase tracking-wide text-slate-300">
                          Medical Leave Lectures (Optional)
                        </label>
                        <input
                          type="number"
                          min="0"
                          className="w-full rounded-xl border border-slate-600/70 bg-slate-900/70 px-3 py-2 text-sm text-slate-100 outline-none ring-emerald-500/40 placeholder:text-slate-500 focus:border-emerald-400 focus:ring-2"
                          value={medicalLeave}
                          onChange={(e) => setMedicalLeave(e.target.value)}
                          placeholder="e.g. 3"
                        />
                        {errors.medicalLeave && (
                          <p className="mt-1 text-xs text-rose-400">
                            {errors.medicalLeave}
                          </p>
                        )}
                      </div>
                    </div>

                    <div>
                      <label className="mb-1 block text-xs font-semibold uppercase tracking-wide text-slate-300">
                        Duty Leave Lectures (Optional)
                      </label>
                      <input
                        type="number"
                        min="0"
                        className="w-full rounded-xl border border-slate-600/70 bg-slate-900/70 px-3 py-2 text-sm text-slate-100 outline-none ring-emerald-500/40 placeholder:text-slate-500 focus:border-emerald-400 focus:ring-2"
                        value={dutyLeave}
                        onChange={(e) => setDutyLeave(e.target.value)}
                        placeholder="e.g. 2"
                      />
                      {errors.dutyLeave && (
                        <p className="mt-1 text-xs text-rose-400">
                          {errors.dutyLeave}
                        </p>
                      )}
                    </div>

                    <div>
                      <label className="mb-1 block text-xs font-semibold uppercase tracking-wide text-slate-300">
                        Plan Leave: Classes to Skip (Simulation)
                      </label>
                      <input
                        type="number"
                        min="0"
                        className="w-full rounded-xl border border-slate-600/70 bg-slate-900/70 px-3 py-2 text-sm text-slate-100 outline-none ring-emerald-500/40 placeholder:text-slate-500 focus:border-emerald-400 focus:ring-2"
                        value={planSkips}
                        onChange={(e) => setPlanSkips(e.target.value)}
                        placeholder="e.g. 2"
                      />
                      {errors.planSkips && (
                        <p className="mt-1 text-xs text-rose-400">
                          {errors.planSkips}
                        </p>
                      )}
                      <p className="mt-1 text-[11px] text-slate-400">
                        Simulate how planning to skip upcoming classes affects your attendance.
                      </p>
                    </div>

                    <button
                      type="submit"
                      disabled={isLoading}
                      className="mt-2 inline-flex w-full items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-emerald-500 to-sky-500 px-4 py-2.5 text-sm font-semibold text-slate-950 shadow-lg shadow-emerald-500/30 transition-all duration-200 hover:from-emerald-400 hover:to-sky-400 hover:shadow-xl disabled:cursor-not-allowed disabled:opacity-60"
                    >
                      {isLoading && (
                        <span className="h-4 w-4 animate-spin rounded-full border-2 border-slate-900 border-t-transparent" />
                      )}
                      Predict Attendance
                    </button>

                    {apiResponse && apiResponse.error && (
                      <p className="mt-2 text-xs text-amber-300">
                        {apiResponse.error}
                      </p>
                    )}
                  </form>
                </div>
              </section>

              {/* Middle: Results */}
              <section className="space-y-4 lg:col-span-1">
                <div className="grid gap-4 md:grid-cols-2">
                  <ResultCard
                    title="Current Attendance"
                    value={currentAttendance ? `${currentAttendance}%` : "--"}
                    highlightColor={currentColor}
                  >
                    Effective attendance after adjusting for medical leave (if any).
                  </ResultCard>

                  <ResultCard
                    title="Status"
                    value={status || "--"}
                    highlightColor={statusColor}
                  >
                    Based on the minimum required threshold of {minRequired}%.
                  </ResultCard>

                  <ResultCard
                    title="Classes You Can Safely Skip"
                    value={canSkip !== null ? `${canSkip} lecture(s)` : "--"}
                    highlightColor={canSkip !== null ? "green" : "yellow"}
                  >
                    Maximum number of future classes you can miss while still staying above{" "}
                    {minRequired}%.
                  </ResultCard>

                  <ResultCard
                    title="Classes You Must Attend"
                    value={mustAttend !== null ? `${mustAttend} lecture(s)` : "--"}
                    highlightColor={
                      mustAttend !== null && mustAttend !== "∞" ? "red" : "yellow"
                    }
                  >
                    Number of upcoming classes you need to attend consecutively to reach{" "}
                    {minRequired}%.
                  </ResultCard>
                </div>

                <div className="grid gap-4 md:grid-cols-2">
                  <ResultCard
                    title="Planned Attendance After Skips"
                    value={plannedAttendance ? `${plannedAttendance}%` : "--"}
                    highlightColor={
                      plannedAttendance ? getRiskLevel(plannedAttendance) : "yellow"
                    }
                  >
                    Predicted attendance if you skip the planned number of future classes.
                  </ResultCard>

                  <ResultCard
                    title="API Insight"
                    value={
                      apiResponse && !apiResponse.error
                        ? apiResponse.prediction || "OK"
                        : apiResponse && apiResponse.error
                        ? "API Error"
                        : "--"
                    }
                    highlightColor={
                      apiResponse && apiResponse.error ? "red" : "green"
                    }
                  >
                    FastAPI backend response (can be extended to show model-based insights).
                  </ResultCard>
                </div>
              </section>

              {/* Right: Chart */}
              <section className="lg:col-span-1">
                <AttendanceChart data={chartData} />
              </section>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<AttendancePredictor />);
  </script>
</body>
</html>
