<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Debug Login - WizUP</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="debug-info">
        <h2>WizUP Login Debug Tool</h2>
        <button class="btn" onclick="checkLocalStorage()">Check LocalStorage</button>
        <button class="btn" onclick="initializeData()">Initialize Student Data</button>
        <button class="btn" onclick="testLogin()">Test Login</button>
        <button class="btn" onclick="clearData()">Clear All Data</button>
        <button class="btn" onclick="clearAndReinitialize()">Clear & Reinitialize</button>
        
        <div id="debugOutput"></div>
    </div>

    <script src="wizup-data.js"></script>
    <script>
        function debug(message) {
            const output = document.getElementById('debugOutput');
            output.innerHTML += '<pre>' + new Date().toLocaleTimeString() + ': ' + message + '</pre>';
        }

        function checkLocalStorage() {
            debug('=== CHECKING LOCALSTORAGE ===');
            
            const users = localStorage.getItem('wizup.users');
            if (users) {
                debug('‚úÖ Found wizup.users in localStorage');
                try {
                    const parsed = JSON.parse(users);
                    debug('‚úÖ Successfully parsed users data');
                    debug('üìä Number of users: ' + parsed.length);
                    parsed.forEach((user, index) => {
                        debug(`   ${index + 1}. UID: ${user.uid}, Name: ${user.name}, Password: ${user.password}`);
                    });
                } catch (e) {
                    debug('‚ùå Error parsing users data: ' + e.message);
                }
            } else {
                debug('‚ùå No wizup.users found in localStorage');
            }

            const currentUser = localStorage.getItem('wizup.currentUser');
            if (currentUser) {
                debug('‚úÖ Found current user session');
            } else {
                debug('‚ÑπÔ∏è No current user session');
            }

            const subjects = localStorage.getItem('wizup.subjects');
            if (subjects) {
                debug('‚úÖ Found subjects data');
            } else {
                debug('‚ùå No subjects data found');
            }
        }

        function initializeData() {
            debug('=== INITIALIZING DATA ===');
            
            try {
                // Check if WIZUP_STUDENTS is available
                if (typeof window.WIZUP_STUDENTS !== 'undefined') {
                    debug('‚úÖ WIZUP_STUDENTS is available');
                    debug('üìä Default students count: ' + window.WIZUP_STUDENTS.length);
                    
                    // Initialize students
                    localStorage.setItem('wizup.users', JSON.stringify(window.WIZUP_STUDENTS));
                    debug('‚úÖ Students initialized in localStorage');
                    
                    // Initialize subjects
                    if (typeof window.WIZUP_SUBJECTS !== 'undefined') {
                        localStorage.setItem('wizup.subjects', JSON.stringify(window.WIZUP_SUBJECTS));
                        debug('‚úÖ Subjects initialized in localStorage');
                    }
                    
                    // Initialize timetable
                    if (typeof window.WIZUP_TIMETABLE !== 'undefined') {
                        localStorage.setItem('wizup.timetable', JSON.stringify(window.WIZUP_TIMETABLE));
                        debug('‚úÖ Timetable initialized in localStorage');
                    }
                    
                    // Initialize fees
                    if (typeof window.WIZUP_FEES !== 'undefined') {
                        localStorage.setItem('wizup.fees', JSON.stringify(window.WIZUP_FEES));
                        debug('‚úÖ Fees initialized in localStorage');
                    }
                    
                    debug('üéâ All data initialized successfully!');
                } else {
                    debug('‚ùå WIZUP_STUDENTS is not available - check if wizup-data.js loaded properly');
                }
            } catch (error) {
                debug('‚ùå Error initializing data: ' + error.message);
            }
        }

        function testLogin() {
            debug('=== TESTING LOGIN ===');
            
            const testUid = 'STU001';
            const testPassword = 'student123';
            
            debug('üîç Testing with UID: ' + testUid + ', Password: ' + testPassword);
            
            try {
                const users = JSON.parse(localStorage.getItem('wizup.users') || '[]');
                debug('üìä Raw users data from localStorage:');
                debug(JSON.stringify(users, null, 2));
                
                debug('üìä Processed users array:');
                users.forEach((user, index) => {
                    debug(`   ${index + 1}. UID: "${user.uid}", Name: "${user.name}", Password: "${user.password}"`);
                    debug(`      Type checks: typeof uid="${typeof user.uid}", typeof password="${typeof user.password}"`);
                });
                
                const user = users.find(u => u.uid === testUid);
                
                if (user) {
                    debug('‚úÖ User found: ' + user.name);
                    debug('üîç Comparing passwords:');
                    debug('   Input password: "' + testPassword + '" (type: ' + typeof testPassword + ')');
                    debug('   Stored password: "' + user.password + '" (type: ' + typeof user.password + ')');
                    debug('   Strict equality: ' + (user.password === testPassword));
                    debug('   Loose equality: ' + (user.password == testPassword));
                    
                    if (user.password === testPassword) {
                        debug('‚úÖ Password matches - Login would succeed!');
                        debug('üë§ User details:');
                        debug('   Name: ' + user.name);
                        debug('   Email: ' + user.email);
                        debug('   Roll No: ' + user.rollNo);
                        debug('   Department: ' + user.department);
                    } else {
                        debug('‚ùå Password does not match');
                        debug('   Expected: "' + testPassword + '"');
                        debug('   Found: "' + user.password + '"');
                    }
                } else {
                    debug('‚ùå User not found with UID: "' + testUid + '"');
                    debug('üìä Available UIDs: [' + users.map(u => '"' + u.uid + '"').join(', ') + ']');
                }
            } catch (error) {
                debug('‚ùå Error testing login: ' + error.message);
            }
        }

        function clearAndReinitialize() {
            debug('=== CLEAR & REINITIALIZING ===');
            
            if (confirm('This will clear all WizUP data and reinitialize with fresh data. Continue?')) {
                localStorage.removeItem('wizup.users');
                localStorage.removeItem('wizup.currentUser');
                localStorage.removeItem('wizup.subjects');
                localStorage.removeItem('wizup.timetable');
                localStorage.removeItem('wizup.fees');
                debug('üóëÔ∏è All WizUP data cleared from localStorage');
                
                // Reinitialize after a short delay
                setTimeout(() => {
                    initializeData();
                }, 100);
            }
        }

        function clearData() {
            debug('=== CLEARING DATA ===');
            
            if (confirm('This will clear all WizUP data from localStorage. Continue?')) {
                localStorage.removeItem('wizup.users');
                localStorage.removeItem('wizup.currentUser');
                localStorage.removeItem('wizup.subjects');
                localStorage.removeItem('wizup.timetable');
                localStorage.removeItem('wizup.fees');
                debug('üóëÔ∏è All WizUP data cleared from localStorage');
            }
        }

        // Auto-check on load
        window.addEventListener('load', function() {
            debug('üöÄ Debug tool loaded');
            checkLocalStorage();
        });
    </script>
</body>
</html>
