<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mark Attendance - WizUP Faculty</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        /* Simple animations */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in { animation: slideIn 0.4s ease-out; }
        
        body {
            font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            background: url("../bg1.jpg") center/cover no-repeat fixed;
            color: #fff;
            min-height: 100vh;
        }
        
        .wrap {
            padding: 24px;
            max-width: 1200px;
            margin: 36px auto;
        }
        
        .card {
            background: linear-gradient(135deg, rgba(15,23,42,0.85), rgba(30,41,59,0.8));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(148,163,184,0.2);
            padding: 32px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 60px rgba(0,0,0,0.35);
        }
        
        a.back {
            color: #fff;
            text-decoration: none;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        a.back:hover {
            background: rgba(255,255,255,0.15);
            transform: translateX(-3px);
        }
        
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .header-title {
            font-size: 28px;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .controls-section {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 8px 12px;
        }
        
        .control-group select, .control-group input {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 14px;
            outline: none;
        }
        
        .control-group select:focus, .control-group input:focus {
            background: rgba(255,255,255,0.15);
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #22c55e, #38bdf8);
            color: #fff;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-1px);
        }
        
        .attendance-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .attendance-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            padding: 14px 16px;
            text-align: left;
            font-weight: 700;
            text-transform: uppercase;
            border: none;
            letter-spacing: 0.5px;
            font-size: 11px;
        }
        
        .attendance-table td {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
            color: #fff;
        }
        
        .attendance-table tr:hover td {
            background: rgba(102, 126, 234, 0.05);
        }
        
        .attendance-table tr:last-child td {
            border-bottom: none;
        }
        
        .attendance-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .attendance-checkbox:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .student-name {
            font-weight: 600;
            color: #fff;
        }
        
        .student-id {
            color: rgba(255,255,255,0.8);
            font-size: 12px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-present {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: #fff;
        }
        
        .status-absent {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: #fff;
        }
        
        .status-medical {
            background: linear-gradient(135deg, #f39c12, #f1c40f);
            color: #fff;
        }
        
        .status-locked {
            background: linear-gradient(135deg, #6b7280, #4c1d95);
            color: #fff;
        }
        
        .warning-message {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: #f59e0b;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .success-message {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #22c55e;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 20px;
            display: none;
        }
        
        @media (max-width: 768px) {
            .wrap {
                padding: 16px;
            }
            
            .card {
                padding: 20px;
            }
            
            .header-section {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }
            
            .controls-section {
                flex-direction: column;
            }
            
            .attendance-table {
                font-size: 12px;
            }
            
            .attendance-table th {
                padding: 10px 8px;
                font-size: 10px;
            }
            
            .attendance-table td {
                padding: 10px 8px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="wrap animate-in">
        <a class="back" href="faculty-dashboard.html">
            <i class="fa-solid fa-arrow-left"></i> Back to Dashboard
        </a>
        
        <div class="card">
            <div class="header-section">
                <div class="header-title">
                    <i class="fa-solid fa-user-check"></i>
                    Mark Attendance
                </div>
            </div>
            
            <div class="warning-message" id="medicalLeaveWarning" style="display: none;">
                <i class="fa-solid fa-exclamation-triangle"></i>
                <span>Some students have approved medical leave. Their attendance is locked and cannot be modified.</span>
            </div>
            
            <div class="success-message" id="successMessage">
                <i class="fa-solid fa-check-circle"></i>
                <span>Attendance saved successfully!</span>
            </div>
            
            <div class="controls-section">
                <div class="control-group">
                    <label for="subjectSelect">Subject:</label>
                    <select id="subjectSelect" onchange="loadStudents()">
                        <option value="">Select Subject</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="dateSelect">Date:</label>
                    <input type="date" id="dateSelect" onchange="loadStudents()">
                </div>
                
                <div class="control-group">
                    <label for="classSelect">Class:</label>
                    <select id="classSelect" onchange="loadStudents()">
                        <option value="">Select Class</option>
                        <option value="A">Class A</option>
                        <option value="B">Class B</option>
                        <option value="C">Class C</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" onclick="saveAttendance()">
                    <i class="fa-solid fa-save"></i>
                    Save Attendance
                </button>
                
                <button class="btn btn-secondary" onclick="markAllPresent()">
                    <i class="fa-solid fa-check-double"></i>
                    Mark All Present
                </button>
            </div>
            
            <table class="attendance-table">
                <thead>
                    <tr>
                        <th>Roll No</th>
                        <th>Student Name</th>
                        <th>Student ID</th>
                        <th>Attendance</th>
                        <th>Status</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody id="attendanceTableBody">
                    <!-- Students will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Faculty auth guard
        (function () {
            try {
                const raw = localStorage.getItem('wizup.currentFaculty');
                if (!raw) {
                    window.location.href = 'faculty-signin.html';
                    return;
                }
            } catch (e) {
                window.location.href = 'faculty-signin.html';
            }
        })();

        // Mock student data with medical leave information
        const studentsData = [
            { rollNo: 'CS301001', name: 'Alice Johnson', studentId: 'STU001', hasMedicalLeave: false, leaveDates: [] },
            { rollNo: 'CS301002', name: 'Bob Smith', studentId: 'STU002', hasMedicalLeave: false, leaveDates: [] },
            { rollNo: 'CS301003', name: 'Charlie Brown', studentId: 'STU003', hasMedicalLeave: true, leaveDates: ['2024-01-15', '2024-01-16'] },
            { rollNo: 'CS301004', name: 'Diana Prince', studentId: 'STU004', hasMedicalLeave: false, leaveDates: [] },
            { rollNo: 'CS301005', name: 'Edward Norton', studentId: 'STU005', hasMedicalLeave: false, leaveDates: [] },
            { rollNo: 'CS301006', name: 'Fiona Green', studentId: 'STU006', hasMedicalLeave: true, leaveDates: ['2024-01-15'] },
            { rollNo: 'CS301007', name: 'George Wilson', studentId: 'STU007', hasMedicalLeave: false, leaveDates: [] },
            { rollNo: 'CS301008', name: 'Hannah Montana', studentId: 'STU008', hasMedicalLeave: false, leaveDates: [] }
        ];

        let currentAttendance = {};

        function initializePage() {
            const faculty = JSON.parse(localStorage.getItem('wizup.currentFaculty'));
            
            // Load faculty subjects
            const subjectSelect = document.getElementById('subjectSelect');
            if (faculty.subjects) {
                faculty.subjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    subjectSelect.appendChild(option);
                });
            }
            
            // Set today's date
            document.getElementById('dateSelect').value = new Date().toISOString().split('T')[0];
        }

        function loadStudents() {
            const subject = document.getElementById('subjectSelect').value;
            const date = document.getElementById('dateSelect').value;
            const classSection = document.getElementById('classSelect').value;
            
            if (!subject || !date || !classSection) {
                document.getElementById('attendanceTableBody').innerHTML = '<tr><td colspan="6" style="text-align: center;">Please select subject, date, and class</td></tr>';
                return;
            }
            
            const tbody = document.getElementById('attendanceTableBody');
            tbody.innerHTML = '';
            
            let hasMedicalLeaveStudents = false;
            
            studentsData.forEach((student, index) => {
                const row = document.createElement('tr');
                row.className = 'animate-in';
                row.style.animationDelay = `${index * 0.05}s`;
                
                // Check if student has medical leave for this date
                const hasMedicalLeaveToday = student.hasMedicalLeave && student.leaveDates.includes(date);
                if (hasMedicalLeaveToday) hasMedicalLeaveStudents = true;
                
                const attendanceKey = `${student.studentId}_${date}`;
                const savedAttendance = localStorage.getItem(attendanceKey);
                const isPresent = savedAttendance === 'present';
                
                row.innerHTML = `
                    <td>${student.rollNo}</td>
                    <td>
                        <div class="student-name">${student.name}</div>
                    </td>
                    <td>
                        <div class="student-id">${student.studentId}</div>
                    </td>
                    <td>
                        <input type="checkbox" 
                               class="attendance-checkbox" 
                               id="attendance_${student.studentId}"
                               ${hasMedicalLeaveToday ? 'disabled' : ''}
                               ${savedAttendance === 'present' ? 'checked' : ''}
                               onchange="updateAttendance('${student.studentId}', '${date}', this.checked)">
                    </td>
                    <td>
                        ${hasMedicalLeaveToday ? 
                            '<span class="status-badge status-locked">Medical Leave</span>' : 
                            isPresent ? 
                            '<span class="status-badge status-present">Present</span>' : 
                            '<span class="status-badge status-absent">Absent</span>'
                        }
                    </td>
                    <td>
                        ${hasMedicalLeaveToday ? 'Approved medical leave - attendance locked' : ''}
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Show/hide medical leave warning
            document.getElementById('medicalLeaveWarning').style.display = hasMedicalLeaveStudents ? 'flex' : 'none';
        }

        function updateAttendance(studentId, date, isPresent) {
            const attendanceKey = `${studentId}_${date}`;
            currentAttendance[attendanceKey] = isPresent ? 'present' : 'absent';
            
            // Update status badge
            const statusBadge = document.querySelector(`#attendance_${studentId}`).closest('tr').querySelector('.status-badge');
            if (statusBadge) {
                statusBadge.className = `status-badge ${isPresent ? 'status-present' : 'status-absent'}`;
                statusBadge.textContent = isPresent ? 'Present' : 'Absent';
            }
        }

        function saveAttendance() {
            const subject = document.getElementById('subjectSelect').value;
            const date = document.getElementById('dateSelect').value;
            const classSection = document.getElementById('classSelect').value;
            
            if (!subject || !date || !classSection) {
                alert('Please select subject, date, and class');
                return;
            }
            
            // Save all attendance data
            studentsData.forEach(student => {
                const attendanceKey = `${student.studentId}_${date}`;
                const checkbox = document.getElementById(`attendance_${student.studentId}`);
                
                if (checkbox && !checkbox.disabled) {
                    localStorage.setItem(attendanceKey, checkbox.checked ? 'present' : 'absent');
                }
            });
            
            // Show success message
            const successMessage = document.getElementById('successMessage');
            successMessage.style.display = 'flex';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }

        function markAllPresent() {
            const checkboxes = document.querySelectorAll('.attendance-checkbox:not(:disabled)');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
                const studentId = checkbox.id.replace('attendance_', '');
                const date = document.getElementById('dateSelect').value;
                updateAttendance(studentId, date, true);
            });
        }

        // Initialize page on load
        document.addEventListener('DOMContentLoaded', () => {
            initializePage();
        });
    </script>
</body>
</html>
