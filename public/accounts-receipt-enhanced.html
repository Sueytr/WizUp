<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Accounts Receipt - WizUP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        /* Simple animations */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in { animation: slideIn 0.4s ease-out; }
        
        body {
            font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            background: url("../bg1.jpg") center/cover no-repeat fixed;
            color: #fff;
            min-height: 100vh;
        }
        
        .wrap {
            padding: 24px;
            max-width: 1400px;
            margin: 36px auto;
        }
        
        .card {
            background: linear-gradient(135deg, rgba(15,23,42,0.85), rgba(30,41,59,0.8));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(148,163,184,0.2);
            padding: 32px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 60px rgba(0,0,0,0.35);
        }
        
        a.back {
            color: #fff;
            text-decoration: none;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        a.back:hover {
            background: rgba(255,255,255,0.15);
            transform: translateX(-3px);
        }
        
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .header-title {
            font-size: 24px;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #22c55e, #38bdf8);
            color: #fff;
        }
        
        .action-btn:hover {
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .filter-group:hover, .search-box:hover {
            background: rgba(255,255,255,0.12);
        }
        
        .receipt-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }
        
        .summary-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            background: rgba(255,255,255,0.08);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .summary-card .icon {
            font-size: 32px;
            margin-bottom: 12px;
            color: #22c55e;
        }
        
        .summary-card .value {
            font-size: 24px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 4px;
        }
        
        .summary-card .label {
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }
        
        .receipts-list {
            margin: 32px 0;
        }
        
        .receipt-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .receipt-item:hover {
            transform: translateY(-2px);
            background: rgba(255,255,255,0.06);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .receipt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .receipt-title {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
        }
        
        .receipt-actions {
            display: flex;
            gap: 8px;
        }
        
        .receipt-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }
        
        .receipt-meta-item {
            display: flex;
            justify-content: space-between;
        }
        
        .receipt-meta-item strong {
            color: #fff;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-paid {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #fff;
        }
        
        .status-pending {
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: #fff;
        }
        
        .status-overdue {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: #fff;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            border-radius: 16px;
        }
        
        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 16px;
            color: rgba(255,255,255,0.5);
        }
        
        .empty-state h3 {
            font-size: 20px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 8px;
        }
        
        .empty-state p {
            font-size: 16px;
            color: rgba(255,255,255,0.8);
            margin-bottom: 24px;
        }
        
        .upload-section {
            margin: 32px 0;
            padding: 24px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            text-align: center;
        }
        
        .upload-area {
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 12px;
            padding: 40px 20px;
            margin: 20px 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.05);
        }
        
        .upload-area.dragover {
            border-color: #22c55e;
            background: rgba(34,197,94,0.1);
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 12px;
            color: rgba(255,255,255,0.7);
        }
        
        .upload-text {
            font-size: 16px;
            color: #fff;
            margin-bottom: 8px;
        }
        
        .upload-hint {
            font-size: 14px;
            color: rgba(255,255,255,0.6);
        }
        
        @media (max-width: 768px) {
            .wrap {
                padding: 16px;
            }
            
            .card {
                padding: 20px;
            }
            
            .receipt-summary {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .header-section {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }
            
            .header-actions {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="wrap animate-in">
        <a class="back" href="student-dashboard.html">
            <i class="fa-solid fa-arrow-left"></i> Back to Dashboard
        </a>
        
        <div class="card">
            <div class="header-section">
                <div class="header-title">
                    <i class="fa-solid fa-file-invoice"></i>
                    Accounts Receipt
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="downloadAllReceipts()">
                        <i class="fa-solid fa-download"></i>
                        Download All
                    </button>
                    <button class="btn btn-secondary" onclick="filterReceipts()">
                        <i class="fa-solid fa-filter"></i>
                        Filter
                    </button>
                </div>
            </div>
            
            <div class="receipt-summary">
                <div class="summary-card animate-in pulse-hover" style="animation-delay: 0.1s;">
                    <div class="icon">
                        <i class="fa-solid fa-receipt"></i>
                    </div>
                    <div class="value" id="totalReceipts">0</div>
                    <div class="label">Total Receipts</div>
                </div>
                
                <div class="summary-card animate-in pulse-hover" style="animation-delay: 0.2s;">
                    <div class="icon">
                        <i class="fa-solid fa-check-circle"></i>
                    </div>
                    <div class="value" id="paidReceipts">0</div>
                    <div class="label">Paid</div>
                </div>
                
                <div class="summary-card animate-in pulse-hover" style="animation-delay: 0.3s;">
                    <div class="icon">
                        <i class="fa-solid fa-clock"></i>
                    </div>
                    <div class="value" id="pendingReceipts">0</div>
                    <div class="label">Pending</div>
                </div>
                
                <div class="summary-card animate-in pulse-hover" style="animation-delay: 0.4s;">
                    <div class="icon">
                        <i class="fa-solid fa-dollar-sign"></i>
                    </div>
                    <div class="value" id="totalAmount">₹0</div>
                    <div class="label">Total Amount</div>
                </div>
            </div>
            
            <div class="receipts-list" id="receiptsList">
                <!-- Receipt items will be dynamically added here -->
            </div>
            
            <div class="empty-state" id="emptyState">
                <div class="icon">
                    <i class="fa-solid fa-file-invoice"></i>
                </div>
                <h3>No Receipts Available</h3>
                <p>You haven't made any fee payments yet.</p>
                <button class="btn btn-primary" onclick="window.location.href='fee-payment.html'">
                    <i class="fa-solid fa-plus"></i>
                    Make a Payment
                </button>
            </div>
            
            <div class="upload-section">
                <div class="upload-area" id="uploadArea" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <div class="upload-icon">
                        <i class="fa-solid fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">Drop receipts here or click to browse</div>
                    <div class="upload-hint">Supported formats: PDF, JPG, PNG (Max 5MB per file)</div>
                    <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png" multiple style="display: none;" onchange="handleFileSelect(event)">
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simple auth guard
        (function () {
            try {
                const raw = localStorage.getItem('wizup.currentUser');
                if (!raw) {
                    window.location.href = 'student-signin.html';
                    return;
                }
            } catch (e) {
                window.location.href = 'student-signin.html';
            }
        })();

        // Sample receipt data (in real app, this would come from backend)
        let receipts = JSON.parse(localStorage.getItem('wizup.receipts') || '[]');
        
        // Initialize with sample data if empty
        if (receipts.length === 0) {
            receipts = [
                {
                    id: 'RCP-001',
                    title: 'Tuition Fee - Fall Semester',
                    date: '2024-08-15',
                    amount: 45000,
                    status: 'paid',
                    paymentMethod: 'Online Banking',
                    transactionId: 'TXN123456789',
                    description: 'Fall semester tuition fees'
                },
                {
                    id: 'RCP-002',
                    title: 'Hostel Fee - August',
                    date: '2024-08-20',
                    amount: 8000,
                    status: 'paid',
                    paymentMethod: 'Cash',
                    transactionId: 'TXN987654321',
                    description: 'August hostel accommodation'
                },
                {
                    id: 'RCP-003',
                    title: 'Library Fine',
                    date: '2024-09-05',
                    amount: 500,
                    status: 'pending',
                    paymentMethod: 'Pending',
                    transactionId: '',
                    description: 'Late return book fine'
                }
            ];
            localStorage.setItem('wizup.receipts', JSON.stringify(receipts));
        }

        function updateReceiptsDisplay() {
            const receiptsList = document.getElementById('receiptsList');
            const emptyState = document.getElementById('emptyState');
            
            if (receipts.length === 0) {
                receiptsList.style.display = 'none';
                emptyState.style.display = 'block';
            } else {
                receiptsList.style.display = 'block';
                emptyState.style.display = 'none';
                
                receiptsList.innerHTML = receipts.map(receipt => `
                    <div class="receipt-item animate-in" style="animation-delay: ${Math.random() * 0.1}s;">
                        <div class="receipt-header">
                            <div class="receipt-title">${receipt.title}</div>
                            <div class="receipt-actions">
                                <span class="status-badge status-${receipt.status}">${receipt.status}</span>
                                <button class="btn btn-secondary" onclick="downloadReceipt('${receipt.id}')">
                                    <i class="fa-solid fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="receipt-meta">
                            <div class="receipt-meta-item">
                                <span>Date:</span>
                                <strong>${receipt.date}</strong>
                            </div>
                            <div class="receipt-meta-item">
                                <span>Amount:</span>
                                <strong>₹${receipt.amount.toLocaleString('en-IN')}</strong>
                            </div>
                            <div class="receipt-meta-item">
                                <span>Method:</span>
                                <strong>${receipt.paymentMethod}</strong>
                            </div>
                            <div class="receipt-meta-item">
                                <span>Transaction ID:</span>
                                <strong>${receipt.transactionId || 'N/A'}</strong>
                            </div>
                        </div>
                        <div style="margin-top: 12px; color: rgba(255,255,255,0.8);">
                            <strong>Description:</strong> ${receipt.description}
                        </div>
                    </div>
                `).join('');
            }
            
            updateSummary();
        }

        function updateSummary() {
            const totalReceipts = receipts.length;
            const paidReceipts = receipts.filter(r => r.status === 'paid').length;
            const pendingReceipts = receipts.filter(r => r.status === 'pending').length;
            const totalAmount = receipts.reduce((sum, r) => sum + r.amount, 0);
            
            document.getElementById('totalReceipts').textContent = totalReceipts;
            document.getElementById('paidReceipts').textContent = paidReceipts;
            document.getElementById('pendingReceipts').textContent = pendingReceipts;
            document.getElementById('totalAmount').textContent = `₹${totalAmount.toLocaleString('en-IN')}`;
        }

        function downloadReceipt(receiptId) {
            const receipt = receipts.find(r => r.id === receiptId);
            if (receipt) {
                // Create a simple receipt text file
                const receiptContent = `
                    WIZUP UNIVERSITY - PAYMENT RECEIPT
                    ==========================================
                    
                    Receipt ID: ${receipt.id}
                    Title: ${receipt.title}
                    Date: ${receipt.date}
                    Amount: ₹${receipt.amount.toLocaleString('en-IN')}
                    Status: ${receipt.status.toUpperCase()}
                    Payment Method: ${receipt.paymentMethod}
                    Transaction ID: ${receipt.transactionId || 'N/A'}
                    
                    Description: ${receipt.description}
                    
                    ==========================================
                    Generated on: ${new Date().toLocaleString()}
                `;
                
                const blob = new Blob([receiptContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `receipt_${receipt.id}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        function downloadAllReceipts() {
            if (receipts.length === 0) {
                alert('No receipts available to download.');
                return;
            }
            
            // Create a combined receipt file
            const allReceiptsContent = receipts.map(receipt => `
                Receipt ID: ${receipt.id}
                Title: ${receipt.title}
                Date: ${receipt.date}
                Amount: ₹${receipt.amount.toLocaleString('en-IN')}
                Status: ${receipt.status.toUpperCase()}
                Payment Method: ${receipt.paymentMethod}
                Transaction ID: ${receipt.transactionId || 'N/A'}
                Description: ${receipt.description}
                ----------------------------------------
            `).join('\n\n');
            
            const headerContent = `
                WIZUP UNIVERSITY - ALL PAYMENT RECEIPTS
                ==========================================
                Generated on: ${new Date().toLocaleString()}
                Total Receipts: ${receipts.length}
                ==========================================
                
                ${allReceiptsContent}
            `;
            
            const blob = new Blob([headerContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `all_receipts_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function filterReceipts() {
            const filter = prompt('Filter receipts by status (paid/pending/all):', 'all');
            if (filter && ['paid', 'pending', 'all'].includes(filter)) {
                const filteredReceipts = filter === 'all' ? receipts : receipts.filter(r => r.status === filter);
                const receiptsList = document.getElementById('receiptsList');
                const emptyState = document.getElementById('emptyState');
                
                if (filteredReceipts.length === 0) {
                    receiptsList.style.display = 'none';
                    emptyState.style.display = 'block';
                } else {
                    receiptsList.style.display = 'block';
                    emptyState.style.display = 'none';
                    
                    receiptsList.innerHTML = filteredReceipts.map(receipt => `
                        <div class="receipt-item animate-in">
                            <div class="receipt-header">
                                <div class="receipt-title">${receipt.title}</div>
                                <div class="receipt-actions">
                                    <span class="status-badge status-${receipt.status}">${receipt.status}</span>
                                    <button class="btn btn-secondary" onclick="downloadReceipt('${receipt.id}')">
                                        <i class="fa-solid fa-download"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="receipt-meta">
                                <div class="receipt-meta-item">
                                    <span>Date:</span>
                                    <strong>${receipt.date}</strong>
                                </div>
                                <div class="receipt-meta-item">
                                    <span>Amount:</span>
                                    <strong>₹${receipt.amount.toLocaleString('en-IN')}</strong>
                                </div>
                                <div class="receipt-meta-item">
                                    <span>Method:</span>
                                    <strong>${receipt.paymentMethod}</strong>
                                </div>
                                <div class="receipt-meta-item">
                                    <span>Transaction ID:</span>
                                    <strong>${receipt.transactionId || 'N/A'}</strong>
                                </div>
                            </div>
                            <div style="margin-top: 12px; color: rgba(255,255,255,0.8);">
                                <strong>Description:</strong> ${receipt.description}
                            </div>
                        </div>
                    `).join('');
                }
            }
        }

        function handleFileSelect(event) {
            const files = event.target.files;
            handleFiles(files);
        }

        function handleDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            handleFiles(files);
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('uploadArea').classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('uploadArea').classList.remove('dragover');
        }

        function handleFiles(files) {
            for (let file of files) {
                if (file.size > 5 * 1024 * 1024) {
                    alert(`File ${file.name} is too large. Maximum size is 5MB.`);
                    continue;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        // In a real app, this would be uploaded to a server
                        // For demo, we'll just log it
                        console.log('Receipt file uploaded:', file.name, e.target.result);
                        
                        // Add to receipts list (demo functionality)
                        const newReceipt = {
                            id: 'UP-' + Date.now(),
                            title: file.name.replace(/\.[^/.]+$/, ''),
                            date: new Date().toISOString().split('T')[0],
                            amount: 0, // Would be extracted from file
                            status: 'pending',
                            paymentMethod: 'File Upload',
                            transactionId: 'FILE-' + Date.now(),
                            description: 'Uploaded receipt file'
                        };
                        
                        receipts.push(newReceipt);
                        localStorage.setItem('wizup.receipts', JSON.stringify(receipts));
                        updateReceiptsDisplay();
                    } catch (error) {
                        console.error('Error processing file:', error);
                        alert('Error processing file. Please try again.');
                    }
                };
                reader.readAsText(file);
            }
        }

        // Initialize the page
        updateReceiptsDisplay();
    </script>
</body>
</html>
