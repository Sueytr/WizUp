<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Analytics - WizUP Faculty</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Simple animations */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in { animation: slideIn 0.4s ease-out; }
        
        body {
            font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            background: url("../bg1.jpg") center/cover no-repeat fixed;
            color: #fff;
            min-height: 100vh;
        }
        
        .wrap {
            padding: 24px;
            max-width: 1400px;
            margin: 36px auto;
        }
        
        .card {
            background: linear-gradient(135deg, rgba(15,23,42,0.85), rgba(30,41,59,0.8));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(148,163,184,0.2);
            padding: 32px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 60px rgba(0,0,0,0.35);
        }
        
        a.back {
            color: #fff;
            text-decoration: none;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        a.back:hover {
            background: rgba(255,255,255,0.15);
            transform: translateX(-3px);
        }
        
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .header-title {
            font-size: 28px;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .controls-section {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 8px 12px;
        }
        
        .control-group select, .control-group input {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 14px;
            outline: none;
        }
        
        .control-group select:focus, .control-group input:focus {
            background: rgba(255,255,255,0.15);
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #22c55e, #38bdf8);
            color: #fff;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-1px);
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .chart-container {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .chart-container:hover {
            transform: translateY(-2px);
            background: rgba(255,255,255,0.08);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .students-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .students-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            padding: 14px 16px;
            text-align: left;
            font-weight: 700;
            text-transform: uppercase;
            border: none;
            letter-spacing: 0.5px;
            font-size: 11px;
        }
        
        .students-table td {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
            color: #fff;
        }
        
        .students-table tr:hover td {
            background: rgba(102, 126, 234, 0.05);
        }
        
        .students-table tr:last-child td {
            border-bottom: none;
        }
        
        .student-name {
            font-weight: 600;
            color: #fff;
        }
        
        .student-id {
            color: rgba(255,255,255,0.8);
            font-size: 12px;
        }
        
        .performance-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .performance-excellent {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: #fff;
        }
        
        .performance-good {
            background: linear-gradient(135deg, #3498db, #5dade2);
            color: #fff;
        }
        
        .performance-average {
            background: linear-gradient(135deg, #f39c12, #f1c40f);
            color: #fff;
        }
        
        .performance-poor {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: #fff;
        }
        
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            background: rgba(255,255,255,0.08);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .stat-icon {
            font-size: 32px;
            margin-bottom: 12px;
            color: #22c55e;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }
        
        @media (max-width: 768px) {
            .wrap {
                padding: 16px;
            }
            
            .card {
                padding: 20px;
            }
            
            .header-section {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }
            
            .controls-section {
                flex-direction: column;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-section {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="wrap animate-in">
        <a class="back" href="faculty-dashboard.html">
            <i class="fa-solid fa-arrow-left"></i> Back to Dashboard
        </a>
        
        <div class="card">
            <div class="header-section">
                <div class="header-title">
                    <i class="fa-solid fa-chart-bar"></i>
                    Student Analytics
                </div>
            </div>
            
            <div class="controls-section">
                <div class="control-group">
                    <label for="subjectSelect">Subject:</label>
                    <select id="subjectSelect" onchange="updateAnalytics()">
                        <option value="">All Subjects</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="classSelect">Class:</label>
                    <select id="classSelect" onchange="updateAnalytics()">
                        <option value="">All Classes</option>
                        <option value="A">Class A</option>
                        <option value="B">Class B</option>
                        <option value="C">Class C</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="timeRange">Time Range:</label>
                    <select id="timeRange" onchange="updateAnalytics()">
                        <option value="month">Last Month</option>
                        <option value="semester">This Semester</option>
                        <option value="year">This Year</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" onclick="exportAnalytics()">
                    <i class="fa-solid fa-download"></i>
                    Export Report
                </button>
            </div>
            
            <div class="stats-section">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fa-solid fa-users"></i>
                    </div>
                    <div class="stat-value" id="totalStudents">156</div>
                    <div class="stat-label">Total Students</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fa-solid fa-chart-line"></i>
                    </div>
                    <div class="stat-value" id="avgPerformance">75%</div>
                    <div class="stat-label">Avg Performance</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fa-solid fa-graduation-cap"></i>
                    </div>
                    <div class="stat-value" id="topPerformers">12</div>
                    <div class="stat-label">Top Performers</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fa-solid fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-value" id="atRiskStudents">8</div>
                    <div class="stat-label">At Risk Students</div>
                </div>
            </div>
            
            <div class="analytics-grid">
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fa-solid fa-chart-pie"></i>
                        Grade Distribution
                    </div>
                    <canvas id="gradeChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fa-solid fa-chart-line"></i>
                        Performance Trend
                    </div>
                    <canvas id="performanceChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fa-solid fa-chart-bar"></i>
                        Attendance vs Performance
                    </div>
                    <canvas id="attendanceChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fa-solid fa-chart-area"></i>
                        Subject-wise Performance
                    </div>
                    <canvas id="subjectChart"></canvas>
                </div>
            </div>
            
            <div style="margin-top: 32px;">
                <div class="chart-title">
                    <i class="fa-solid fa-users"></i>
                    Individual Student Performance
                </div>
                
                <table class="students-table">
                    <thead>
                        <tr>
                            <th>Roll No</th>
                            <th>Student Name</th>
                            <th>Student ID</th>
                            <th>Attendance</th>
                            <th>Avg Marks</th>
                            <th>Grade</th>
                            <th>Performance</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody">
                        <!-- Students will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Faculty auth guard
        (function () {
            try {
                const raw = localStorage.getItem('wizup.currentFaculty');
                if (!raw) {
                    window.location.href = 'faculty-signin.html';
                    return;
                }
            } catch (e) {
                window.location.href = 'faculty-signin.html';
            }
        })();

        // Mock student data
        const studentsData = [
            { rollNo: 'CS301001', name: 'Alice Johnson', studentId: 'STU001', attendance: 92, avgMarks: 85, grade: 'A' },
            { rollNo: 'CS301002', name: 'Bob Smith', studentId: 'STU002', attendance: 78, avgMarks: 72, grade: 'B' },
            { rollNo: 'CS301003', name: 'Charlie Brown', studentId: 'STU003', attendance: 65, avgMarks: 58, grade: 'C' },
            { rollNo: 'CS301004', name: 'Diana Prince', studentId: 'STU004', attendance: 88, avgMarks: 91, grade: 'A' },
            { rollNo: 'CS301005', name: 'Edward Norton', studentId: 'STU005', attendance: 95, avgMarks: 87, grade: 'A' },
            { rollNo: 'CS301006', name: 'Fiona Green', studentId: 'STU006', attendance: 45, avgMarks: 42, grade: 'D' },
            { rollNo: 'CS301007', name: 'George Wilson', studentId: 'STU007', attendance: 82, avgMarks: 76, grade: 'B' },
            { rollNo: 'CS301008', name: 'Hannah Montana', studentId: 'STU008', attendance: 90, avgMarks: 83, grade: 'A' }
        ];

        let gradeChart, performanceChart, attendanceChart, subjectChart;

        function initializePage() {
            const faculty = JSON.parse(localStorage.getItem('wizup.currentFaculty'));
            
            // Load faculty subjects
            const subjectSelect = document.getElementById('subjectSelect');
            if (faculty.subjects) {
                faculty.subjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    subjectSelect.appendChild(option);
                });
            }
            
            // Initialize charts
            initializeCharts();
            
            // Load students table
            loadStudentsTable();
        }

        function initializeCharts() {
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#fff'
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#fff' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    y: {
                        ticks: { color: '#fff' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    }
                }
            };

            // Grade Distribution Chart
            const gradeCtx = document.getElementById('gradeChart').getContext('2d');
            gradeChart = new Chart(gradeCtx, {
                type: 'pie',
                data: {
                    labels: ['A', 'B', 'C', 'D', 'F'],
                    datasets: [{
                        data: [30, 25, 20, 15, 10],
                        backgroundColor: [
                            '#27ae60',
                            '#3498db',
                            '#f39c12',
                            '#e67e22',
                            '#e74c3c'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    }
                }
            });

            // Performance Trend Chart
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(performanceCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Average Performance',
                        data: [72, 75, 78, 74, 80, 75],
                        borderColor: '#38bdf8',
                        backgroundColor: 'rgba(56, 189, 248, 0.1)',
                        tension: 0.4
                    }]
                },
                options: chartOptions
            });

            // Attendance vs Performance Chart
            const attendanceCtx = document.getElementById('attendanceChart').getContext('2d');
            attendanceChart = new Chart(attendanceCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Students',
                        data: studentsData.map(student => ({
                            x: student.attendance,
                            y: student.avgMarks
                        })),
                        backgroundColor: '#22c55e'
                    }]
                },
                options: chartOptions
            });

            // Subject-wise Performance Chart
            const subjectCtx = document.getElementById('subjectChart').getContext('2d');
            subjectChart = new Chart(subjectCtx, {
                type: 'bar',
                data: {
                    labels: ['Java', 'System Design', 'Software Eng', 'Deep Learning', 'ML'],
                    datasets: [{
                        label: 'Average Marks',
                        data: [78, 82, 75, 85, 79],
                        backgroundColor: '#667eea'
                    }]
                },
                options: chartOptions
            });
        }

        function loadStudentsTable() {
            const tbody = document.getElementById('studentsTableBody');
            tbody.innerHTML = '';
            
            studentsData.forEach((student, index) => {
                const row = document.createElement('tr');
                row.className = 'animate-in';
                row.style.animationDelay = `${index * 0.05}s`;
                
                const performanceClass = getPerformanceClass(student.avgMarks);
                const performanceText = getPerformanceText(student.avgMarks);
                
                row.innerHTML = `
                    <td>${student.rollNo}</td>
                    <td>
                        <div class="student-name">${student.name}</div>
                    </td>
                    <td>
                        <div class="student-id">${student.studentId}</div>
                    </td>
                    <td>${student.attendance}%</td>
                    <td>${student.avgMarks}</td>
                    <td>${student.grade}</td>
                    <td>
                        <span class="performance-badge ${performanceClass}">${performanceText}</span>
                    </td>
                    <td>
                        <button class="btn btn-secondary" onclick="viewStudentDetails('${student.studentId}')">
                            <i class="fa-solid fa-eye"></i> View
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function getPerformanceClass(marks) {
            if (marks >= 85) return 'performance-excellent';
            if (marks >= 75) return 'performance-good';
            if (marks >= 60) return 'performance-average';
            return 'performance-poor';
        }

        function getPerformanceText(marks) {
            if (marks >= 85) return 'Excellent';
            if (marks >= 75) return 'Good';
            if (marks >= 60) return 'Average';
            return 'Poor';
        }

        function updateAnalytics() {
            // This would typically fetch data from the server based on filters
            // For now, we'll just refresh the charts with mock data
            loadStudentsTable();
        }

        function viewStudentDetails(studentId) {
            const student = studentsData.find(s => s.studentId === studentId);
            if (student) {
                alert(`Student Details:\n\nName: ${student.name}\nRoll No: ${student.rollNo}\nStudent ID: ${student.studentId}\nAttendance: ${student.attendance}%\nAverage Marks: ${student.avgMarks}\nGrade: ${student.grade}\n\nThis would open a detailed student profile in a real application.`);
            }
        }

        function exportAnalytics() {
            let csvContent = 'Roll No,Student Name,Student ID,Attendance,Average Marks,Grade,Performance\n';
            
            studentsData.forEach(student => {
                const performanceText = getPerformanceText(student.avgMarks);
                csvContent += `${student.rollNo},${student.name},${student.studentId},${student.attendance}%,${student.avgMarks},${student.grade},${performanceText}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `student_analytics_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize page on load
        document.addEventListener('DOMContentLoaded', () => {
            initializePage();
        });
    </script>
</body>
</html>
